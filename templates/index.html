<!DOCTYPE html>
<html>
<head>
		<style>
				body {
						margin: 0;
						padding: 0;
				}
				.container {
						display: flex;
						height: 70vh;
				}
				.left-half {
						width: 50%;
						background-color: #f0f0f0;
						padding: 20px;
				}
				.right-half {
						width: 50%;
						background-color: #f0f0f0;
						padding: 20px;
				}
				.file-list {
						margin-top: 20px;
						max-height: 50vh;
						overflow-y: auto;
				}
				.file-item {
						background-color: white;
						padding: 10px;
						margin: 5px 0;
						border-radius: 5px;
						display: flex;
						justify-content: space-between;
						align-items: center;
				}
				.file-item button {
						background-color: #4CAF50;
						color: white;
						border: none;
						padding: 5px 15px;
						border-radius: 3px;
						cursor: pointer;
				}
				.file-item button:hover {
						background-color: #45a049;
				}
		</style>
</head>
<body>
		<h1>Quickshare</h1>
		<div class="container">
				<div class="left-half">
						<h2>Text</h2>
						<form method="POST">
								<textarea name="text" style="width:100%;height:75vh;">{paste_text}</textarea>
								<br>
								<button type="submit">Save</button>
						</form>
				</div>
				<div class="right-half">
						<h2>Files</h2>
								<input type="file" id="fileInput" name="file" multiple>
								<br><br>
								<button id="uploadBtn">Upload</button>
								<div id="uploadStatus"></div>

								<div class="file-list" id="fileList">
								    <h3>Downloadable Files:</h3>
										<div id="filesContainer"></div>
								</div>

								<script>
									const uploadBtn = document.getElementById('uploadBtn');
									const fileInput = document.getElementById('fileInput');
									const status = document.getElementById('uploadStatus');
									const filesContainer = document.getElementById('filesContainer');

									// Load files when page loads
									loadFiles();

									uploadBtn.addEventListener('click', async () => {
										console.log("upload clicked");
										const files = fileInput.files;

										if (files.length === 0) {
											status.textContent = 'No files uploaded';
											return;
										}

										const formData = new FormData();
										for (let i = 0; i < files.length; i++) {
											formData.append('files', files[i]);
										}

										try {
											const response = await fetch('/upload', {
												method: 'POST',
												body: formData
											});
											const result = await response.json();

											if (response.ok) {
												status.textContent = 'Uploaded file';
												fileInput.value = '';  // Clear input
												loadFiles();  // Refresh file list
											} else {
												status.textContent = 'Failed to upload file, ' + result.error;
											}
										} catch (error) {
											status.textContent = 'ERROR: ' + error.message;
										}
									});

									// Function to load files from server
									async function loadFiles() {
										try {
											const response = await fetch('/files');
											const result = await response.json();

											if (response.ok) {
												displayFiles(result.files);
											}
										} catch (error) {
											console.error('Error loading files:', error);
										}
									}

									function displayFiles(files) {
										if (files.length === 0) {
											filesContainer.innerHTML = '<p>No files</p>';
											return;
										}

										filesContainer.innerHTML = files.map(filename => `
											<div class="file-item">
												<span>${filename}</span>
												<button onclick="downloadFile('${filename}')">Download</button>
											</div>
										`).join('');
									}

									function downloadFile(filename) {
										window.location.href = '/download/' + encodeURIComponent(filename);
									}
								</script>
				</div>
		</div>
</body>
</html>
